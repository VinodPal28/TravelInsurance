$(window).on("load",function(){var t=d3.select("#waterfall"),a={top:20,right:20,bottom:30,left:50},n=t.node().getBoundingClientRect().width-a.left-a.right,d=500-a.top-a.bottom;padding=.3;var l=d3.scale.ordinal().rangeRoundBands([0,n],padding),i=d3.scale.linear().range([d,0]),o=d3.svg.axis().scale(l).orient("bottom"),s=d3.svg.axis().scale(i).orient("left").tickFormat(function(t){return u(t)}),e=t.append("svg"),c=e.attr("width",n+a.left+a.right).attr("height",d+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");function u(t){var a=t=Math.round(t);return 1e3<Math.abs(t)&&(a=Math.round(t/1e3)+"K"),"$"+a}function r(){n=t.node().getBoundingClientRect().width-a.left-a.right,e.attr("width",n+a.left+a.right),c.attr("width",n+a.left+a.right),l.rangeRoundBands([0,n],padding),c.selectAll(".d3-xaxis").call(o),c.selectAll(".d3-bar").attr("transform",function(t){return"translate("+l(t.name)+",0)"}),c.selectAll(".d3-bar rect").attr("width",l.rangeBand()),c.selectAll(".d3-bar text").attr("x",l.rangeBand()/2),c.selectAll(".d3-connector").attr("x1",l.rangeBand()+5).attr("x2",l.rangeBand()/(1-padding)-5)}d3.csv("data/d3/bar/waterfall.csv",function(t){return t.value=+t.value,t},function(t,a){if(t)throw t;for(var n=0,e=0;e<a.length;e++)a[e].start=n,n+=a[e].value,a[e].end=n,a[e].class=0<=a[e].value?"positive":"negative";a.push({name:"Total",end:n,start:0,class:"total"}),l.domain(a.map(function(t){return t.name})),i.domain([0,d3.max(a,function(t){return t.end})]),c.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+d+")").call(o),c.append("g").attr("class","d3-axis d3-yaxis").call(s);var r=c.selectAll(".d3-bar").data(a).enter().append("g").attr("class",function(t){return"d3-bar "+t.class}).attr("transform",function(t){return"translate("+l(t.name)+",0)"});r.append("rect").attr("y",function(t){return i(Math.max(t.start,t.end))}).attr("height",function(t){return Math.abs(i(t.start)-i(t.end))}).attr("width",l.rangeBand()),r.append("text").attr("x",l.rangeBand()/2).attr("y",function(t){return i(t.end)+5}).attr("dy",function(t){return("negative"==t.class?"-":"")+".75em"}).text(function(t){return u(t.end-t.start)}),r.filter(function(t){return"total"!=t.class}).append("line").attr("class","d3-connector").attr("x1",l.rangeBand()+5).attr("y1",function(t){return i(t.end)}).attr("x2",l.rangeBand()/(1-padding)-5).attr("y2",function(t){return i(t.end)})}),$(window).on("resize",r),$(".menu-toggle").on("click",r)});