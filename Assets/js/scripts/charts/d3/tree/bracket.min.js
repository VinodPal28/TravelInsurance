$(window).on("load",function(){var i,u=d3.select("#bracket-tree"),d={top:0,right:0,bottom:0,left:0},f=u.node().getBoundingClientRect().width-d.left-d.right,h=f/2,l=600-d.top-d.bottom-5,y=0,g=500,v=u.append("svg"),x=v.attr("width",f+d.left+d.right).attr("height",l+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")"),t=d3.behavior.zoom().scaleExtent([1,2]).on("zoom",function(){x.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});v.call(t);var w=d3.layout.tree().size([l,f]),m=(d3.svg.diagonal().projection(function(t){return[t.y,t.x]}),function(t,e){var r=k(t.source),n=k(t.target),i=(n.y-r.y)/2;return t.isRight&&(i=-i),"M"+r.y+","+r.x+"H"+(r.y+i)+"V"+n.x+"H"+n.y}),k=function(t){var e=t.y;return t.isRight||(e=t.y-h,e=h-e),{x:t.x,y:e}},B=function(t,e){e=e||[];var r=0,n=t.children?t.children.length:0;for(e.push(t);r<n;r++)B(t.children[r],e);return e};d3.json("data/d3/tree/bracket-tree.json",function(t){(i=t).x0=l/2,i.y0=f/2;var e=d3.layout.tree().size([l,h]).children(function(t){return t.winners}),r=d3.layout.tree().size([l,h]).children(function(t){return t.challengers});e.nodes(i),r.nodes(i);var n=function(t){t.children=function(t){var e=[];if(t.winners)for(var r=0;r<t.winners.length;r++)t.winners[r].isRight=!1,t.winners[r].parent=t,e.push(t.winners[r]);if(t.challengers)for(r=0;r<t.challengers.length;r++)t.challengers[r].isRight=!0,t.challengers[r].parent=t,e.push(t.challengers[r]);return e.length?e:null}(t),t.children&&t.children.forEach(n)};n(i),i.isRight=!1,function e(r){var t=B(r);t.forEach(function(t){t.y=180*t.depth+h});var n=x.selectAll("g.node").data(t,function(t){return t.id||(t.id=++y)});t.forEach(function(t){var e=k(t);t.x0=e.x,t.y0=e.y});var i=n.enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+r.y0+","+r.x0+")"}).on("click",function l(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null);!function e(r){var t=B(r);t.forEach(function(t){t.y=180*t.depth+h});var n=x.selectAll("g.node").data(t,function(t){return t.id||(t.id=++y)});t.forEach(function(t){var e=k(t);t.x0=e.x,t.y0=e.y});var i=n.enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+r.y0+","+r.x0+")"}).on("click",c);i.append("circle").attr("r",1e-6).style("stroke","#F6BB42").style("stroke-width",1.5).style("cursor","pointer").style("fill",function(t){return t._children?"#F6BB42":"#fff"});i.append("text").attr("dy",function(t){return t.isRight?18:-12}).attr("text-anchor","middle").text(function(t){return t.name}).style("font-size",12).style("fill-opacity",1e-6);var l=n.transition().duration(g).attr("transform",function(t){return p=k(t),"translate("+p.y+","+p.x+")"});l.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"#F6BB42":"#fff"});l.select("text").style("fill-opacity",1);var a=n.exit().transition().duration(g).attr("transform",function(t){return p=k(t.parent||r),"translate("+p.y+","+p.x+")"}).remove();a.select("circle").attr("r",1e-6);a.select("text").style("fill-opacity",1e-6);var o=x.selectAll("path.link").data(w.links(t),function(t){return t.target.id});o.enter().insert("path","g").attr("class","link").style("stroke","#F6BB42").style("fill","none").style("stroke-width",1.5).attr("d",function(t){var e={x:r.x0,y:r.y0};return m({source:e,target:e})});o.transition().duration(g).attr("d",m);o.exit().transition().duration(g).attr("d",function(t){var e=k(t.source||r);return t.source.isRight?e.y-=h-(t.target.y-t.source.y):e.y+=h-(t.target.y-t.source.y),m({source:e,target:e})}).remove();function c(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),e(r)}$(window).on("resize",s);$(".menu-toggle").on("click",s);function s(){f=u.node().getBoundingClientRect().width-d.left-d.right,v.attr("width",f+d.left+d.right),x.attr("width",f+d.left+d.right)}}(r)});i.append("circle").attr("r",1e-6).style("stroke","#F6BB42").style("stroke-width",1.5).style("cursor","pointer").style("fill",function(t){return t._children?"#F6BB42":"#fff"});i.append("text").attr("dy",function(t){return t.isRight?18:-12}).attr("text-anchor","middle").text(function(t){return t.name}).style("font-size",12).style("fill-opacity",1e-6);var a=n.transition().duration(g).attr("transform",function(t){return p=k(t),"translate("+p.y+","+p.x+")"});a.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"#F6BB42":"#fff"});a.select("text").style("fill-opacity",1);var o=n.exit().transition().duration(g).attr("transform",function(t){return p=k(t.parent||r),"translate("+p.y+","+p.x+")"}).remove();o.select("circle").attr("r",1e-6);o.select("text").style("fill-opacity",1e-6);var c=x.selectAll("path.link").data(w.links(t),function(t){return t.target.id});c.enter().insert("path","g").attr("class","link").style("stroke","#F6BB42").style("fill","none").style("stroke-width",1.5).attr("d",function(t){var e={x:r.x0,y:r.y0};return m({source:e,target:e})});c.transition().duration(g).attr("d",m);c.exit().transition().duration(g).attr("d",function(t){var e=k(t.source||r);return t.source.isRight?e.y-=h-(t.target.y-t.source.y):e.y+=h-(t.target.y-t.source.y),m({source:e,target:e})}).remove();function l(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),e(r)}$(window).on("resize",s);$(".menu-toggle").on("click",s);function s(){f=u.node().getBoundingClientRect().width-d.left-d.right,v.attr("width",f+d.left+d.right),x.attr("width",f+d.left+d.right)}}(i)})});